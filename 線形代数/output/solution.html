<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線形代数 解答</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', 'Yu Mincho', 'YuMincho', 'Hiragino Mincho ProN', serif;
            line-height: 2;
            color: #000;
            background: #fafafa;
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 50px 60px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            color: #000;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 1.8em;
            text-align: center;
        }

        h2 {
            color: #000;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }

        .problem {
            background: #fff;
            padding: 20px;
            margin: 30px 0;
            border: 1px solid #000;
        }

        .problem-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .step {
            background: #fff;
            padding: 20px;
            margin: 25px 0;
            border-left: 3px solid #000;
            padding-left: 25px;
        }

        .step-title {
            font-weight: bold;
            font-size: 1.05em;
            margin-bottom: 15px;
        }

        .formula {
            background: #fff;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            overflow-x: auto;
        }

        .explanation {
            margin: 15px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 2px solid #666;
            padding-left: 20px;
        }

        .answer-box {
            background: #fff;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid #000;
        }

        .answer-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }

        .verification {
            background: #fff;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #666;
        }

        .verification-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .calculation {
            margin: 10px 0;
            padding: 10px;
            border-left: 2px solid #ccc;
            padding-left: 15px;
        }

        .note {
            background: #fff;
            padding: 12px;
            margin: 15px 0;
            border: 1px dashed #666;
            font-size: 0.95em;
        }

        p {
            margin: 10px 0;
            text-align: justify;
        }

        .solution-number {
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>線形代数 問１５（１）解答</h1>

        <div class="problem">
            <div class="problem-title">【問題】</div>
            <p>次の2次曲面を標準化して図示します。</p>
            <div class="formula">
                $$x^2 + y^2 - 2z^2 - 4yz = 1$$
            </div>
            <p>（1葉双曲面）</p>
        </div>

        <h2>【解答】</h2>

        <div class="step">
            <div class="step-title">（1）2次式を行列で表します。</div>
            <p>まず、与えられた2次曲面 $x^2 + y^2 - 2z^2 - 4yz = 1$ を行列を用いて表します。</p>
            <p>3次元の2次形式 $ax^2 + by^2 + cz^2 + 2hxy + 2fyz + 2gzx$ は、対称行列を用いて次のように表すことができます。</p>
            <div class="formula">
                $$ax^2 + by^2 + cz^2 + 2hxy + 2fyz + 2gzx = \begin{pmatrix} x & y & z \end{pmatrix} \begin{pmatrix} a & h & g \\ h & b & f \\ g & f & c \end{pmatrix} \begin{pmatrix} x \\ y \\ z \end{pmatrix}$$
            </div>
            <p>与えられた式 $x^2 + y^2 - 2z^2 - 4yz$ において、各項の係数を確認します。$x^2$ の係数は $a = 1$、$y^2$ の係数は $b = 1$、$z^2$ の係数は $c = -2$、$xy$ の係数は $0$ より $h = 0$、$yz$ の係数は $-4$ より $2f = -4$ から $f = -2$、$zx$ の係数は $0$ より $g = 0$ です。したがって、対応する対称行列 $A$ は</p>
            <div class="formula">
                $$A = \begin{pmatrix} 1 & 0 & 0 \\ 0 & 1 & -2 \\ 0 & -2 & -2 \end{pmatrix}$$
            </div>
            <p>となります。これにより、与えられた2次曲面は</p>
            <div class="formula">
                $$\begin{pmatrix} x & y & z \end{pmatrix} \begin{pmatrix} 1 & 0 & 0 \\ 0 & 1 & -2 \\ 0 & -2 & -2 \end{pmatrix} \begin{pmatrix} x \\ y \\ z \end{pmatrix} = 1$$
            </div>
            <p>と表されます。</p>
        </div>

        <div class="step">
            <div class="step-title">（2）行列 $A$ の固有値と固有ベクトルを求めます。</div>
            <p>行列 $A$ を対角化するために、まず固有値を求めます。固有値 $\lambda$ は特性方程式 $\det(A - \lambda I) = 0$ を解くことで求められます。</p>
            <div class="calculation">
                $$\det(A - \lambda I) = \det\begin{pmatrix} 1-\lambda & 0 & 0 \\ 0 & 1-\lambda & -2 \\ 0 & -2 & -2-\lambda \end{pmatrix}$$
            </div>
            <p>第1列で展開すると、</p>
            <div class="calculation">
                $$\det(A - \lambda I) = (1-\lambda) \det\begin{pmatrix} 1-\lambda & -2 \\ -2 & -2-\lambda \end{pmatrix} = (1-\lambda)[(1-\lambda)(-2-\lambda) - 4]$$
            </div>
            <p>この式を展開すると、</p>
            <div class="calculation">
                $$(1-\lambda)[(1-\lambda)(-2-\lambda) - 4] = (1-\lambda)[-2 - \lambda + 2\lambda + \lambda^2 - 4] = (1-\lambda)(\lambda^2 + \lambda - 6)$$
            </div>
            <p>$\lambda^2 + \lambda - 6 = (\lambda + 3)(\lambda - 2)$ と因数分解できるので、</p>
            <div class="formula">
                $$\det(A - \lambda I) = (1-\lambda)(\lambda + 3)(\lambda - 2) = 0$$
            </div>
            <p>となるので、固有値は $\lambda_1 = 1$、$\lambda_2 = -3$、$\lambda_3 = 2$ です。</p>
            <p>次に、各固有値に対応する固有ベクトルを求めます。</p>
            <p>固有値 $\lambda_1 = 1$ に対応する固有ベクトル $\boldsymbol{v}_1 = \begin{pmatrix} v_{11} \\ v_{12} \\ v_{13} \end{pmatrix}$ は、$(A - I)\boldsymbol{v}_1 = \boldsymbol{0}$ を満たします。</p>
            <div class="calculation">
                $$(A - I)\boldsymbol{v}_1 = \begin{pmatrix} 0 & 0 & 0 \\ 0 & 0 & -2 \\ 0 & -2 & -3 \end{pmatrix}\begin{pmatrix} v_{11} \\ v_{12} \\ v_{13} \end{pmatrix} = \begin{pmatrix} 0 \\ 0 \\ 0 \end{pmatrix}$$
            </div>
            <p>この連立方程式を解くと、第2行から $-2v_{13} = 0$ より $v_{13} = 0$、第3行から $-2v_{12} - 3v_{13} = 0$ より $v_{12} = 0$ です。$v_{11}$ は任意なので、$\boldsymbol{v}_1 = \begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix}$ が固有ベクトルとなります（定数倍を除いて）。</p>
            <p>固有値 $\lambda_2 = -3$ に対応する固有ベクトル $\boldsymbol{v}_2 = \begin{pmatrix} v_{21} \\ v_{22} \\ v_{23} \end{pmatrix}$ は、$(A + 3I)\boldsymbol{v}_2 = \boldsymbol{0}$ を満たします。</p>
            <div class="calculation">
                $$(A + 3I)\boldsymbol{v}_2 = \begin{pmatrix} 4 & 0 & 0 \\ 0 & 4 & -2 \\ 0 & -2 & 1 \end{pmatrix}\begin{pmatrix} v_{21} \\ v_{22} \\ v_{23} \end{pmatrix} = \begin{pmatrix} 0 \\ 0 \\ 0 \end{pmatrix}$$
            </div>
            <p>この連立方程式を解くと、第1行から $4v_{21} = 0$ より $v_{21} = 0$、第2行から $4v_{22} - 2v_{23} = 0$ より $v_{23} = 2v_{22}$、第3行から $-2v_{22} + v_{23} = 0$ も同じ関係を与えます。したがって、$\boldsymbol{v}_2 = \begin{pmatrix} 0 \\ 1 \\ 2 \end{pmatrix}$ が固有ベクトルとなります（定数倍を除いて）。</p>
            <p>固有値 $\lambda_3 = 2$ に対応する固有ベクトル $\boldsymbol{v}_3 = \begin{pmatrix} v_{31} \\ v_{32} \\ v_{33} \end{pmatrix}$ は、$(A - 2I)\boldsymbol{v}_3 = \boldsymbol{0}$ を満たします。</p>
            <div class="calculation">
                $$(A - 2I)\boldsymbol{v}_3 = \begin{pmatrix} -1 & 0 & 0 \\ 0 & -1 & -2 \\ 0 & -2 & -4 \end{pmatrix}\begin{pmatrix} v_{31} \\ v_{32} \\ v_{33} \end{pmatrix} = \begin{pmatrix} 0 \\ 0 \\ 0 \end{pmatrix}$$
            </div>
            <p>この連立方程式を解くと、第1行から $-v_{31} = 0$ より $v_{31} = 0$、第2行から $-v_{32} - 2v_{33} = 0$ より $v_{32} = -2v_{33}$ です。したがって、$\boldsymbol{v}_3 = \begin{pmatrix} 0 \\ -2 \\ 1 \end{pmatrix}$ が固有ベクトルとなります（定数倍を除いて）。</p>
        </div>

        <div class="step">
            <div class="step-title">（3）固有ベクトルを正規化して直交行列を作ります。</div>
            <p>固有ベクトルを正規化して、直交行列 $P$ を構成します。正規化とは、ベクトルの長さを $1$ にすることです。</p>
            <p>まず、$\boldsymbol{v}_1 = \begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix}$ の長さ（ノルム）を計算します。</p>
            <div class="calculation">
                $$\|\boldsymbol{v}_1\| = \sqrt{1^2 + 0^2 + 0^2} = \sqrt{1} = 1$$
            </div>
            <p>したがって、$\boldsymbol{v}_1$ は既に正規化されているので、$\boldsymbol{q}_1 = \begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix}$ です。</p>
            <p>次に、$\boldsymbol{v}_2 = \begin{pmatrix} 0 \\ 1 \\ 2 \end{pmatrix}$ の長さを計算します。</p>
            <div class="calculation">
                $$\|\boldsymbol{v}_2\| = \sqrt{0^2 + 1^2 + 2^2} = \sqrt{0 + 1 + 4} = \sqrt{5}$$
            </div>
            <p>したがって、正規化されたベクトルは</p>
            <div class="formula">
                $$\boldsymbol{q}_2 = \frac{1}{\sqrt{5}}\begin{pmatrix} 0 \\ 1 \\ 2 \end{pmatrix} = \begin{pmatrix} 0 \\ \dfrac{1}{\sqrt{5}} \\ \dfrac{2}{\sqrt{5}} \end{pmatrix}$$
            </div>
            <p>となります。最後に、$\boldsymbol{v}_3 = \begin{pmatrix} 0 \\ -2 \\ 1 \end{pmatrix}$ の長さを計算します。</p>
            <div class="calculation">
                $$\|\boldsymbol{v}_3\| = \sqrt{0^2 + (-2)^2 + 1^2} = \sqrt{0 + 4 + 1} = \sqrt{5}$$
            </div>
            <p>したがって、正規化されたベクトルは</p>
            <div class="formula">
                $$\boldsymbol{q}_3 = \frac{1}{\sqrt{5}}\begin{pmatrix} 0 \\ -2 \\ 1 \end{pmatrix} = \begin{pmatrix} 0 \\ -\dfrac{2}{\sqrt{5}} \\ \dfrac{1}{\sqrt{5}} \end{pmatrix}$$
            </div>
            <p>となります。これらの正規化された固有ベクトルを列ベクトルとして並べた行列</p>
            <div class="formula">
                $$P = \begin{pmatrix} \boldsymbol{q}_1 & \boldsymbol{q}_2 & \boldsymbol{q}_3 \end{pmatrix} = \begin{pmatrix}
                1 & 0 & 0 \\
                0 & \dfrac{1}{\sqrt{5}} & -\dfrac{2}{\sqrt{5}} \\
                0 & \dfrac{2}{\sqrt{5}} & \dfrac{1}{\sqrt{5}}
                \end{pmatrix}$$
            </div>
            <p>は直交行列となります。これは、$P$ の列ベクトルが正規直交基底をなしているためです。</p>
            <div class="note">
                <p>対称行列の異なる固有値に属する固有ベクトルは自動的に直交するため、正規化すれば正規直交基底が得られます。これにより、直交行列による対角化が可能になります。</p>
            </div>
        </div>

        <div class="step">
            <div class="step-title">（4）座標変換を行って標準形を得ます。</div>
            <p>直交行列 $P$ を用いて、$A$ は対角化されます。すなわち、</p>
            <div class="formula">
                $$A = P\begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix}{}^tP$$
            </div>
            <p>が成り立ちます。ここで、${}^tP$ は $P$ の転置行列であり、直交行列の性質 ${}^tP = P^{-1}$ を用いています。</p>
            <p>座標変換 $\begin{pmatrix} x \\ y \\ z \end{pmatrix} = P\begin{pmatrix} x' \\ y' \\ z' \end{pmatrix}$ を適用すると、元の2次形式は</p>
            <div class="formula">
                $$\begin{pmatrix} x & y & z \end{pmatrix} A \begin{pmatrix} x \\ y \\ z \end{pmatrix} = \begin{pmatrix} x' & y' & z' \end{pmatrix} {}^tP A P \begin{pmatrix} x' \\ y' \\ z' \end{pmatrix}$$
            </div>
            <p>と変形されます。ここで、${}^tP A P$ を計算します。$A = P\begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix}{}^tP$ であることから、</p>
            <div class="calculation">
                $${}^tP A P = {}^tP \cdot P\begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix}{}^tP \cdot P$$
            </div>
            <p>直交行列の性質 ${}^tP P = I$（単位行列）を用いると、</p>
            <div class="calculation">
                $${}^tP A P = I \begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix} I = \begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix}$$
            </div>
            <p>となります。したがって、座標変換後の2次形式は</p>
            <div class="formula">
                $$\begin{pmatrix} x' & y' & z' \end{pmatrix} \begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix} \begin{pmatrix} x' \\ y' \\ z' \end{pmatrix} = x'^2 - 3y'^2 + 2z'^2 = 1$$
            </div>
            <p>となります。これが標準形です。1葉双曲面は、正の固有値に対応する項（$x'^2$ と $2z'^2$）と負の固有値に対応する項（$-3y'^2$）が混在する形で表されます。この場合、$x'$ 軸方向と $z'$ 軸方向に実軸を持ち、$y'$ 軸方向に虚軸を持つ1葉双曲面となります。</p>
            <div class="answer-box">
                <div class="answer-title">【答え】</div>
                <p>標準化された2次曲面は</p>
                <div class="formula">
                    $$x'^2 - 3y'^2 + 2z'^2 = 1$$
                </div>
                <p>で表され、これは1葉双曲面です。座標変換は直交行列</p>
                <div class="formula">
                    $$P = \begin{pmatrix}
                    1 & 0 & 0 \\
                    0 & \dfrac{1}{\sqrt{5}} & -\dfrac{2}{\sqrt{5}} \\
                    0 & \dfrac{2}{\sqrt{5}} & \dfrac{1}{\sqrt{5}}
                    \end{pmatrix}$$
                </div>
                <p>によって行われ、$x'$ 軸は固有ベクトル $\begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix}$ の方向、$y'$ 軸は固有ベクトル $\begin{pmatrix} 0 \\ 1 \\ 2 \end{pmatrix}$ の方向、$z'$ 軸は固有ベクトル $\begin{pmatrix} 0 \\ -2 \\ 1 \end{pmatrix}$ の方向に対応します。1葉双曲面は、$x'$ 軸方向と $z'$ 軸方向に実軸を持ち、$y'$ 軸方向に虚軸を持つ双曲面です。</p>
            </div>
        </div>

        <div class="step">
            <div class="step-title">（5）図示します。</div>
            <p>標準形 $x'^2 - 3y'^2 + 2z'^2 = 1$ で表される1葉双曲面を図示します。この曲面は、$x'$ 軸方向と $z'$ 軸方向に実軸を持つ双曲面です。</p>
            <p>$y' = 0$ の断面を考えると、$x'^2 + 2z'^2 = 1$ となり、これは $xz$ 平面内の楕円です。</p>
            <div class="formula">
                <svg width="500" height="400" viewBox="0 0 500 400" style="max-width: 100%; height: auto; background: #fafafa;">
                    <defs>
                        <marker id="arrowhead1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#000" />
                        </marker>
                        <pattern id="grid1" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <!-- グリッド -->
                    <rect width="500" height="400" fill="url(#grid1)" />
                    <!-- 座標軸 -->
                    <line x1="50" y1="350" x2="450" y2="350" stroke="#000" stroke-width="2.5" marker-end="url(#arrowhead1)" />
                    <text x="460" y="355" font-size="16" fill="#000" font-weight="bold">$x'$</text>
                    <line x1="250" y1="50" x2="250" y2="350" stroke="#000" stroke-width="2.5" marker-end="url(#arrowhead1)" />
                    <text x="255" y="45" font-size="16" fill="#000" font-weight="bold">$z'$</text>
                    <!-- 目盛り -->
                    <line x1="150" y1="345" x2="150" y2="355" stroke="#666" stroke-width="1.5" />
                    <text x="145" y="370" font-size="12" fill="#666">$-1$</text>
                    <line x1="250" y1="345" x2="250" y2="355" stroke="#666" stroke-width="1.5" />
                    <text x="245" y="370" font-size="12" fill="#666">$0$</text>
                    <line x1="350" y1="345" x2="350" y2="355" stroke="#666" stroke-width="1.5" />
                    <text x="345" y="370" font-size="12" fill="#666">$1$</text>
                    <line x1="245" y1="250" x2="255" y2="250" stroke="#666" stroke-width="1.5" />
                    <text x="260" y="255" font-size="12" fill="#666">$1/\sqrt{2}$</text>
                    <line x1="245" y1="300" x2="255" y2="300" stroke="#666" stroke-width="1.5" />
                    <text x="260" y="305" font-size="12" fill="#666">$0$</text>
                    <line x1="245" y1="350" x2="255" y2="350" stroke="#666" stroke-width="1.5" />
                    <!-- 楕円 x'^2 + 2z'^2 = 1 (y'=0の断面) -->
                    <!-- 標準形: (x'/1)^2 + (z'/(1/√2))^2 = 1 -->
                    <ellipse cx="250" cy="350" rx="200" ry="141.42" fill="none" stroke="#0066cc" stroke-width="3" opacity="0.9" />
                    <ellipse cx="250" cy="350" rx="200" ry="141.42" fill="rgba(0,102,204,0.1)" stroke="none" />
                    <text x="120" y="200" font-size="14" fill="#0066cc" font-weight="bold">$x'^2 + 2z'^2 = 1$</text>
                    <!-- 中心点 -->
                    <circle cx="250" cy="350" r="4" fill="#000" />
                    <text x="255" y="365" font-size="13" fill="#000" font-weight="bold">$O$</text>
                </svg>
            </div>
            <p>$x' = 0$ の断面を考えると、$-3y'^2 + 2z'^2 = 1$ すなわち $2z'^2 - 3y'^2 = 1$ となり、これは $yz$ 平面内の双曲線です。</p>
            <div class="formula">
                <svg width="500" height="400" viewBox="0 0 500 400" style="max-width: 100%; height: auto; background: #fafafa;">
                    <defs>
                        <marker id="arrowhead2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#000" />
                        </marker>
                        <pattern id="grid2" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <!-- グリッド -->
                    <rect width="500" height="400" fill="url(#grid2)" />
                    <!-- 座標軸 -->
                    <line x1="50" y1="200" x2="450" y2="200" stroke="#000" stroke-width="2.5" marker-end="url(#arrowhead2)" />
                    <text x="460" y="205" font-size="16" fill="#000" font-weight="bold">$y'$</text>
                    <line x1="250" y1="50" x2="250" y2="350" stroke="#000" stroke-width="2.5" marker-end="url(#arrowhead2)" />
                    <text x="255" y="45" font-size="16" fill="#000" font-weight="bold">$z'$</text>
                    <!-- 目盛り -->
                    <line x1="150" y1="195" x2="150" y2="205" stroke="#666" stroke-width="1.5" />
                    <text x="145" y="220" font-size="12" fill="#666">$-1$</text>
                    <line x1="250" y1="195" x2="250" y2="205" stroke="#666" stroke-width="1.5" />
                    <text x="245" y="220" font-size="12" fill="#666">$0$</text>
                    <line x1="350" y1="195" x2="350" y2="205" stroke="#666" stroke-width="1.5" />
                    <text x="345" y="220" font-size="12" fill="#666">$1$</text>
                    <!-- 双曲線 2z'^2 - 3y'^2 = 1 (x'=0の断面) -->
                    <!-- z' = ±sqrt((1+3y'^2)/2) -->
                    <path id="hyperbola1" d="M 250 150" fill="none" stroke="#cc6600" stroke-width="3" opacity="0.9" />
                    <path id="hyperbola2" d="M 250 250" fill="none" stroke="#cc6600" stroke-width="3" opacity="0.9" />
                    <!-- 漸近線（点線）z' = ±sqrt(3/2) y' -->
                    <line x1="50" y1="50" x2="450" y2="350" stroke="#cc6600" stroke-width="1.5" stroke-dasharray="5,5" opacity="0.4" />
                    <line x1="50" y1="350" x2="450" y2="50" stroke="#cc6600" stroke-width="1.5" stroke-dasharray="5,5" opacity="0.4" />
                    <text x="120" y="120" font-size="14" fill="#cc6600" font-weight="bold">$2z'^2 - 3y'^2 = 1$</text>
                    <!-- 中心点 -->
                    <circle cx="250" cy="200" r="4" fill="#000" />
                    <text x="255" y="215" font-size="13" fill="#000" font-weight="bold">$O$</text>
                </svg>
            </div>
            <p>$z' = 0$ の断面を考えると、$x'^2 - 3y'^2 = 1$ となり、これは $xy$ 平面内の双曲線です。</p>
            <div class="formula">
                <svg width="500" height="400" viewBox="0 0 500 400" style="max-width: 100%; height: auto; background: #fafafa;">
                    <defs>
                        <marker id="arrowhead3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#000" />
                        </marker>
                        <pattern id="grid3" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <!-- グリッド -->
                    <rect width="500" height="400" fill="url(#grid3)" />
                    <!-- 座標軸 -->
                    <line x1="50" y1="200" x2="450" y2="200" stroke="#000" stroke-width="2.5" marker-end="url(#arrowhead3)" />
                    <text x="460" y="205" font-size="16" fill="#000" font-weight="bold">$x'$</text>
                    <line x1="250" y1="50" x2="250" y2="350" stroke="#000" stroke-width="2.5" marker-end="url(#arrowhead3)" />
                    <text x="255" y="45" font-size="16" fill="#000" font-weight="bold">$y'$</text>
                    <!-- 目盛り -->
                    <line x1="150" y1="195" x2="150" y2="205" stroke="#666" stroke-width="1.5" />
                    <text x="145" y="220" font-size="12" fill="#666">$-1$</text>
                    <line x1="250" y1="195" x2="250" y2="205" stroke="#666" stroke-width="1.5" />
                    <text x="245" y="220" font-size="12" fill="#666">$0$</text>
                    <line x1="350" y1="195" x2="350" y2="205" stroke="#666" stroke-width="1.5" />
                    <text x="345" y="220" font-size="12" fill="#666">$1$</text>
                    <!-- 双曲線 x'^2 - 3y'^2 = 1 (z'=0の断面) -->
                    <!-- x' = ±sqrt(1+3y'^2) -->
                    <path id="hyperbola3" d="M 350 200" fill="none" stroke="#009900" stroke-width="3" opacity="0.9" />
                    <path id="hyperbola4" d="M 150 200" fill="none" stroke="#009900" stroke-width="3" opacity="0.9" />
                    <!-- 漸近線（点線）x' = ±sqrt(3) y' -->
                    <line x1="50" y1="50" x2="250" y2="200" stroke="#009900" stroke-width="1.5" stroke-dasharray="5,5" opacity="0.4" />
                    <line x1="50" y1="350" x2="250" y2="200" stroke="#009900" stroke-width="1.5" stroke-dasharray="5,5" opacity="0.4" />
                    <line x1="450" y1="50" x2="250" y2="200" stroke="#009900" stroke-width="1.5" stroke-dasharray="5,5" opacity="0.4" />
                    <line x1="450" y1="350" x2="250" y2="200" stroke="#009900" stroke-width="1.5" stroke-dasharray="5,5" opacity="0.4" />
                    <text x="280" y="120" font-size="14" fill="#009900" font-weight="bold">$x'^2 - 3y'^2 = 1$</text>
                    <!-- 中心点 -->
                    <circle cx="250" cy="200" r="4" fill="#000" />
                    <text x="255" y="215" font-size="13" fill="#000" font-weight="bold">$O$</text>
                </svg>
            </div>
            <p>これらの断面を組み合わせると、1葉双曲面の形状が理解できます。さらに、Plotly.jsを用いた3次元の正確なグラフを示します（マウスで回転・拡大縮小が可能です）。</p>
            <div class="formula">
                <div id="plotly-3d-surface" style="width: 100%; height: 600px; margin: 20px 0;"></div>
            </div>
            <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
            <script>
                (function() {
                    const range = 2.5;
                    const n = 100; // 解像度を上げる
                    
                    const x = [];
                    const y = [];
                    const zPos = [];
                    const zNeg = [];
                    
                    for (let j = 0; j <= n; j++) {
                        x.push(-range + (2 * range * j / n));
                    }
                    
                    for (let i = 0; i <= n; i++) {
                        const yVal = -range + (2 * range * i / n);
                        y.push(yVal);
                        
                        const zPosRow = [];
                        const zNegRow = [];
                        
                        for (let j = 0; j <= n; j++) {
                            const xVal = x[j];
                            const rhs = 1 + 3 * yVal * yVal - xVal * xVal;
                            
                            if (rhs >= 0) {
                                const z = Math.sqrt(rhs / 2);
                                zPosRow.push(z);
                                zNegRow.push(-z);
                            } else {
                                zPosRow.push(null);
                                zNegRow.push(null);
                            }
                        }
                        
                        zPos.push(zPosRow);
                        zNeg.push(zNegRow);
                    }
                    
                    const trace1 = {
                        x: x,
                        y: y,
                        z: zPos,
                        type: 'surface',
                        colorscale: [
                            [0, 'rgb(50,100,200)'],
                            [0.2, 'rgb(80,140,240)'],
                            [0.4, 'rgb(120,170,255)'],
                            [0.6, 'rgb(160,200,255)'],
                            [0.8, 'rgb(200,220,255)'],
                            [1, 'rgb(230,240,255)']
                        ],
                        showscale: false,
                        opacity: 0.92,
                        name: '上側',
                        lighting: {
                            ambient: 0.7,
                            diffuse: 0.8,
                            specular: 0.3,
                            roughness: 0.5,
                            fresnel: 0.2
                        },
                        lightposition: {
                            x: 100,
                            y: 100,
                            z: 100
                        },
                        contours: {
                            x: { 
                                show: true, 
                                color: 'rgba(80,80,80,0.4)', 
                                width: 1,
                                highlight: true,
                                highlightcolor: 'rgba(0,0,0,0.6)',
                                highlightwidth: 2
                            },
                            y: { 
                                show: true, 
                                color: 'rgba(80,80,80,0.4)', 
                                width: 1,
                                highlight: true,
                                highlightcolor: 'rgba(0,0,0,0.6)',
                                highlightwidth: 2
                            },
                            z: { 
                                show: true, 
                                color: 'rgba(80,80,80,0.4)', 
                                width: 1,
                                highlight: true,
                                highlightcolor: 'rgba(0,0,0,0.6)',
                                highlightwidth: 2
                            }
                        }
                    };
                    
                    const trace2 = {
                        x: x,
                        y: y,
                        z: zNeg,
                        type: 'surface',
                        colorscale: [
                            [0, 'rgb(200,140,60)'],
                            [0.2, 'rgb(230,170,90)'],
                            [0.4, 'rgb(255,200,120)'],
                            [0.6, 'rgb(255,220,150)'],
                            [0.8, 'rgb(255,235,180)'],
                            [1, 'rgb(255,245,210)']
                        ],
                        showscale: false,
                        opacity: 0.92,
                        name: '下側',
                        lighting: {
                            ambient: 0.7,
                            diffuse: 0.8,
                            specular: 0.3,
                            roughness: 0.5,
                            fresnel: 0.2
                        },
                        lightposition: {
                            x: 100,
                            y: 100,
                            z: 100
                        },
                        contours: {
                            x: { 
                                show: true, 
                                color: 'rgba(80,80,80,0.4)', 
                                width: 1,
                                highlight: true,
                                highlightcolor: 'rgba(0,0,0,0.6)',
                                highlightwidth: 2
                            },
                            y: { 
                                show: true, 
                                color: 'rgba(80,80,80,0.4)', 
                                width: 1,
                                highlight: true,
                                highlightcolor: 'rgba(0,0,0,0.6)',
                                highlightwidth: 2
                            },
                            z: { 
                                show: true, 
                                color: 'rgba(80,80,80,0.4)', 
                                width: 1,
                                highlight: true,
                                highlightcolor: 'rgba(0,0,0,0.6)',
                                highlightwidth: 2
                            }
                        }
                    };
                    
                    const layout = {
                        title: {
                            text: '1葉双曲面: x\'² - 3y\'² + 2z\'² = 1',
                            font: { size: 18, family: 'Times New Roman', color: '#000' },
                            x: 0.5,
                            xanchor: 'center',
                            y: 0.98,
                            yanchor: 'top'
                        },
                        scene: {
                            xaxis: { 
                                title: 'x\'',
                                titlefont: { size: 16, family: 'Times New Roman', color: '#000' },
                                backgroundcolor: 'rgb(255,255,255)',
                                gridcolor: 'rgba(150,150,150,0.3)',
                                showbackground: true,
                                showgrid: true,
                                showline: true,
                                linecolor: '#000',
                                linewidth: 2,
                                zeroline: true,
                                zerolinecolor: '#666',
                                zerolinewidth: 1.5
                            },
                            yaxis: { 
                                title: 'y\'',
                                titlefont: { size: 16, family: 'Times New Roman', color: '#000' },
                                backgroundcolor: 'rgb(255,255,255)',
                                gridcolor: 'rgba(150,150,150,0.3)',
                                showbackground: true,
                                showgrid: true,
                                showline: true,
                                linecolor: '#000',
                                linewidth: 2,
                                zeroline: true,
                                zerolinecolor: '#666',
                                zerolinewidth: 1.5
                            },
                            zaxis: { 
                                title: 'z\'',
                                titlefont: { size: 16, family: 'Times New Roman', color: '#000' },
                                backgroundcolor: 'rgb(255,255,255)',
                                gridcolor: 'rgba(150,150,150,0.3)',
                                showbackground: true,
                                showgrid: true,
                                showline: true,
                                linecolor: '#000',
                                linewidth: 2,
                                zeroline: true,
                                zerolinecolor: '#666',
                                zerolinewidth: 1.5
                            },
                            camera: {
                                eye: { x: 2.2, y: 2.2, z: 2.2 },
                                center: { x: 0, y: 0, z: 0 },
                                up: { x: 0, y: 0, z: 1 }
                            },
                            aspectmode: 'cube',
                            bgcolor: 'rgb(250,250,250)'
                        },
                        margin: { l: 0, r: 0, t: 80, b: 0 },
                        paper_bgcolor: 'white',
                        plot_bgcolor: 'white'
                    };
                    
                    const config = {
                        responsive: true,
                        displayModeBar: true,
                        modeBarButtonsToRemove: ['pan2d', 'select2d', 'lasso2d'],
                        displaylogo: false,
                        toImageButtonOptions: {
                            format: 'png',
                            filename: 'hyperboloid',
                            width: 1200,
                            height: 900,
                            scale: 2
                        }
                    };
                    
                    Plotly.newPlot('plotly-3d-surface', [trace1, trace2], layout, config);
                    
                    window.addEventListener('resize', function() {
                        Plotly.Plots.resize('plotly-3d-surface');
                    });
                })();
                
                // SVG双曲線の描画
                (function() {
                    // 双曲線1: 2z'^2 - 3y'^2 = 1 (x'=0の断面)
                    const centerX1 = 250, centerY1 = 200;
                    const scale1 = 100;
                    let path1 = 'M ' + centerX1 + ' ' + (centerY1 - scale1 * Math.sqrt(0.5));
                    let path2 = 'M ' + centerX1 + ' ' + (centerY1 + scale1 * Math.sqrt(0.5));
                    
                    for (let y = -2; y <= 2; y += 0.05) {
                        const z = Math.sqrt((1 + 3 * y * y) / 2);
                        const x1 = centerX1 + y * scale1;
                        const y1 = centerY1 - z * scale1;
                        const x2 = centerX1 + y * scale1;
                        const y2 = centerY1 + z * scale1;
                        
                        if (y1 >= 50 && y1 <= 350) path1 += ' L ' + x1 + ' ' + y1;
                        if (y2 >= 50 && y2 <= 350) path2 += ' L ' + x2 + ' ' + y2;
                    }
                    
                    const hyp1 = document.getElementById('hyperbola1');
                    const hyp2 = document.getElementById('hyperbola2');
                    if (hyp1) hyp1.setAttribute('d', path1);
                    if (hyp2) hyp2.setAttribute('d', path2);
                    
                    // 双曲線2: x'^2 - 3y'^2 = 1 (z'=0の断面)
                    const centerX2 = 250, centerY2 = 200;
                    const scale2 = 100;
                    let path3 = 'M ' + (centerX2 + scale2) + ' ' + centerY2;
                    let path4 = 'M ' + (centerX2 - scale2) + ' ' + centerY2;
                    
                    for (let y = -2; y <= 2; y += 0.05) {
                        const x = Math.sqrt(1 + 3 * y * y);
                        const x1 = centerX2 + x * scale2;
                        const y1 = centerY2 - y * scale2;
                        const x2 = centerX2 - x * scale2;
                        const y2 = centerY2 - y * scale2;
                        
                        if (x1 >= 50 && x1 <= 450 && y1 >= 50 && y1 <= 350) path3 += ' L ' + x1 + ' ' + y1;
                        if (x2 >= 50 && x2 <= 450 && y2 >= 50 && y2 <= 350) path4 += ' L ' + x2 + ' ' + y2;
                    }
                    
                    const hyp3 = document.getElementById('hyperbola3');
                    const hyp4 = document.getElementById('hyperbola4');
                    if (hyp3) hyp3.setAttribute('d', path3);
                    if (hyp4) hyp4.setAttribute('d', path4);
                })();
            </script>
            <p>以上の断面図と等軸測図から、1葉双曲面 $x'^2 - 3y'^2 + 2z'^2 = 1$ は、$x'$ 軸方向と $z'$ 軸方向に広がり、$y'$ 軸方向に双曲線状の形状を持つ連続した1つの曲面（1葉）として表されます。これは、原点を中心とした双曲回転面の一種です。</p>
            <div class="explanation">
                <p>1葉双曲面の特徴：標準形 $x'^2 - 3y'^2 + 2z'^2 = 1$ において、正の係数を持つ項（$x'^2$ と $2z'^2$）は実軸を表し、負の係数を持つ項（$-3y'^2$）は虚軸を表します。この曲面は、$x'z'$ 平面内で楕円断面を持ち、$x'y'$ 平面および $y'z'$ 平面内で双曲線断面を持ちます。全体として、1つの連続した曲面（1葉）を形成します。</p>
            </div>
        </div>

        <div class="verification">
            <div class="verification-title">【検証】</div>
            <p>最後に、求めた結果が正しいことを確認します。</p>
            <p>まず、直交行列 $P$ が正しく構成されていることを確認します。$P$ の列ベクトル $\boldsymbol{q}_1$、$\boldsymbol{q}_2$、$\boldsymbol{q}_3$ の内積を計算すると、</p>
            <div class="calculation">
                $$\boldsymbol{q}_1 \cdot \boldsymbol{q}_2 = \begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix} \cdot \begin{pmatrix} 0 \\ \dfrac{1}{\sqrt{5}} \\ \dfrac{2}{\sqrt{5}} \end{pmatrix} = 1 \cdot 0 + 0 \cdot \frac{1}{\sqrt{5}} + 0 \cdot \frac{2}{\sqrt{5}} = 0$$
            </div>
            <div class="calculation">
                $$\boldsymbol{q}_1 \cdot \boldsymbol{q}_3 = \begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix} \cdot \begin{pmatrix} 0 \\ -\dfrac{2}{\sqrt{5}} \\ \dfrac{1}{\sqrt{5}} \end{pmatrix} = 1 \cdot 0 + 0 \cdot \left(-\frac{2}{\sqrt{5}}\right) + 0 \cdot \frac{1}{\sqrt{5}} = 0$$
            </div>
            <div class="calculation">
                $$\boldsymbol{q}_2 \cdot \boldsymbol{q}_3 = \begin{pmatrix} 0 \\ \dfrac{1}{\sqrt{5}} \\ \dfrac{2}{\sqrt{5}} \end{pmatrix} \cdot \begin{pmatrix} 0 \\ -\dfrac{2}{\sqrt{5}} \\ \dfrac{1}{\sqrt{5}} \end{pmatrix} = 0 \cdot 0 + \frac{1}{\sqrt{5}} \cdot \left(-\frac{2}{\sqrt{5}}\right) + \frac{2}{\sqrt{5}} \cdot \frac{1}{\sqrt{5}} = -\frac{2}{5} + \frac{2}{5} = 0$$
            </div>
            <p>となり、すべての列ベクトルが互いに直交していることが確認できます。また、各列ベクトルの長さは</p>
            <div class="calculation">
                $$\|\boldsymbol{q}_1\| = \sqrt{1^2 + 0^2 + 0^2} = \sqrt{1} = 1$$
            </div>
            <div class="calculation">
                $$\|\boldsymbol{q}_2\| = \sqrt{0^2 + \left(\frac{1}{\sqrt{5}}\right)^2 + \left(\frac{2}{\sqrt{5}}\right)^2} = \sqrt{\frac{1}{5} + \frac{4}{5}} = \sqrt{\frac{5}{5}} = \sqrt{1} = 1$$
            </div>
            <div class="calculation">
                $$\|\boldsymbol{q}_3\| = \sqrt{0^2 + \left(-\frac{2}{\sqrt{5}}\right)^2 + \left(\frac{1}{\sqrt{5}}\right)^2} = \sqrt{\frac{4}{5} + \frac{1}{5}} = \sqrt{\frac{5}{5}} = \sqrt{1} = 1$$
            </div>
            <p>となり、正規化されていることが確認できます。したがって、$P$ は確かに直交行列です。</p>
            <p>次に、対角化の等式 ${}^tP A P = \begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix}$ が成り立つことを確認します。固有値と固有ベクトルの関係 $A\boldsymbol{q}_i = \lambda_i\boldsymbol{q}_i$ を用いると、$AP$ の各列は固有値倍された固有ベクトルになります。すなわち、</p>
            <div class="calculation">
                $$AP = A\begin{pmatrix} \boldsymbol{q}_1 & \boldsymbol{q}_2 & \boldsymbol{q}_3 \end{pmatrix} = \begin{pmatrix} A\boldsymbol{q}_1 & A\boldsymbol{q}_2 & A\boldsymbol{q}_3 \end{pmatrix} = \begin{pmatrix} 1 \cdot \boldsymbol{q}_1 & -3 \cdot \boldsymbol{q}_2 & 2 \cdot \boldsymbol{q}_3 \end{pmatrix}$$
            </div>
            <p>したがって、${}^tP(AP)$ は</p>
            <div class="calculation">
                $${}^tP(AP) = {}^tP\begin{pmatrix} \boldsymbol{q}_1 & -3\boldsymbol{q}_2 & 2\boldsymbol{q}_3 \end{pmatrix}$$
            </div>
            <p>ここで、${}^tP$ の行ベクトルは $P$ の列ベクトル（正規直交基底）なので、${}^tP$ の第 $i$ 行と $\boldsymbol{q}_j$ の内積は、$i = j$ のとき $1$、$i \neq j$ のとき $0$ になります。したがって、${}^tP(AP)$ の $(i,j)$ 成分は、$i = j$ のとき固有値 $\lambda_i$、$i \neq j$ のとき $0$ になります。これにより、</p>
            <div class="formula">
                $${}^tP A P = \begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix}$$
            </div>
            <p>となり、確かに対角行列になっています。したがって、座標変換後の2次形式が $x'^2 - 3y'^2 + 2z'^2 = 1$ となることが確認できました。</p>
            <p>さらに、元の式 $x^2 + y^2 - 2z^2 - 4yz = 1$ に座標変換を適用した結果が、標準形 $x'^2 - 3y'^2 + 2z'^2 = 1$ と一致することを確認します。座標変換 $\begin{pmatrix} x \\ y \\ z \end{pmatrix} = P\begin{pmatrix} x' \\ y' \\ z' \end{pmatrix}$ を元の式に代入すると、</p>
            <div class="calculation">
                $$x^2 + y^2 - 2z^2 - 4yz = \begin{pmatrix} x & y & z \end{pmatrix} A \begin{pmatrix} x \\ y \\ z \end{pmatrix} = \begin{pmatrix} x' & y' & z' \end{pmatrix} {}^tP A P \begin{pmatrix} x' \\ y' \\ z' \end{pmatrix} = \begin{pmatrix} x' & y' & z' \end{pmatrix} \begin{pmatrix} 1 & 0 & 0 \\ 0 & -3 & 0 \\ 0 & 0 & 2 \end{pmatrix} \begin{pmatrix} x' \\ y' \\ z' \end{pmatrix} = x'^2 - 3y'^2 + 2z'^2 = 1$$
            </div>
            <p>となり、標準形と一致することが確認できます。</p>
            <p>以上より求めた結果の正しさを確認しました。</p>
        </div>
    </div>
</body>
</html>
